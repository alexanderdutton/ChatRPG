import google.genai as genai
from google.genai.types import GenerateContentConfig, Modality  # Import necessary types
from PIL import Image
from io import BytesIO
import os

# Configure the API key
genai.configure(api_key=os.environ["GEMINI_API_KEY"])  # Or configure directly with your key

# Choose a model that supports image generation
# Note: The search results mention various models, including "imagen-4.0-generate-preview-06-06"
# and "gemini-2.0-flash-exp" or "gemini-2.0-flash-preview-image-generation".
# Please refer to the official documentation for the latest available models that support image generation.
model_name = "gemini-2.0-flash-exp" # Example model name, update if needed

# Define the prompt
prompt = "Generate an illustration of a fantasy landscape." # Your image generation prompt

# Configure the image generation request
response = genai.generate_content(
    model=model_name,
    contents=prompt,
    config=GenerateContentConfig(response_modalities=[Modality.TEXT, Modality.IMAGE]),  # Configure response modalities
)

# Process the response to save the image
for i, part in enumerate(response.candidates[0].content.parts):
    if part.inline_data is not None:
        try:
            image = Image.open(BytesIO(part.inline_data.data))  # Use BytesIO with the image data
            # You can check part.inline_data.mime_type here to confirm the mime type if needed
            image.save(f"generated_image_{i+1}.png")  # Save the image as a PNG file
            print(f"Image saved as generated_image_{i+1}.png")
        except Exception as e:
            print(f"Error processing image data: {e}")