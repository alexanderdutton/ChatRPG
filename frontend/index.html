<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini NPC Game</title>
    <style>
        /* Light Mode (Default) */
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; transition: background-color 0.3s, color 0.3s; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: background-color 0.3s; }
        #dialogue-box { border: 1px solid #ddd; padding: 15px; height: 400px; background-color: #e9e9e9; border-radius: 4px; flex: 1 1 50%; display: flex; flex-direction: column; }
        #dialogue-box .messages { flex-grow: 1; overflow-y: auto; }
        .message { margin-bottom: 10px; }
        .user-message { text-align: right; color: #0056b3; }
        .npc-message { text-align: left; color: #28a745; }
        input[type="text"] { width: calc(100% - 80px); padding: 10px; border: 1px solid #ccc; border-radius: 4px; background-color: #fff; color: #333; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 5px; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        .loading { color: #888; font-style: italic; }

        /* Header and Status styles */
        .header-bar { display: flex; justify-content: space-between; align-items: center; }
        .header-right-items { display: flex; align-items: center; gap: 15px; }
        #status { width: 20px; height: 20px; border-radius: 50%; }
        .status-ok { background-color: #28a745; }
        .status-error { background-color: #dc3545; }
        #dark-mode-toggle { font-size: 1.5em; cursor: pointer; background: none; border: none; padding: 0; color: #333; }

        /* Layout */
        .main-game-area { display: flex; flex-direction: column; gap: 20px; }
        .top-row { display: flex; gap: 20px; align-items: stretch; }
        .bottom-row { display: flex; justify-content: space-between; gap: 20px; }
        .map-container { flex: 1 1 50%; display: flex; flex-direction: column; border: 1px solid #ddd; border-radius: 4px; background-color: #e9e9e9; height: 400px; }
        .tabcontent { flex-grow: 1; display: flex; flex-direction: column; padding: 10px; overflow-y: auto; }

        /* Game State Card */
        .game-state-card { background-color: #ffffff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: background-color 0.3s, border-color 0.3s; }
        .game-state-card p { margin: 5px 0; }

        /* D-pad */
        .d-pad-container { display: grid; grid-template-areas: ". north ." "west center east" ". south ."; grid-template-columns: repeat(3, 60px); grid-template-rows: repeat(3, 60px); gap: 2px; width: 184px; margin: 20px auto; background-color: #333; border-radius: 10px; padding: 2px; }
        .d-pad-button { background-color: #555; color: white; border: none; border-radius: 5px; font-size: 1em; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .d-pad-button:hover { background-color: #777; }
        .d-pad-button.north { grid-area: north; }
        .d-pad-button.west { grid-area: west; }
        .d-pad-button.center { grid-area: center; }
        .d-pad-button.east { grid-area: east; }
        .d-pad-button.south { grid-area: south; }

        /* Tabs */
        .tabs { overflow: hidden; border-bottom: 1px solid #ccc; background-color: #f1f1f1; transition: background-color 0.3s, border-color 0.3s; }
        .tablink { background-color: #e9e9e9; color: #666; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 17px; border-bottom: 3px solid transparent; }
        .tablink:hover { background-color: #ddd; }
        .tablink.active { background-color: #fff; color: #007bff; border-bottom: 3px solid #007bff; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
        .modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 80%; border-radius: 8px; position: relative; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close-button:hover, .close-button:focus { color: black; text-decoration: none; cursor: pointer; }

        /* Hamburger */
        .hamburger-menu { font-size: 2em; cursor: pointer; }

        /* Map */
        #game-map { background-color: #e9e9e9; margin:0px;padding: 0px; border-radius: 4px; font-family: monospace; font-size: 1.5em; flex-grow: 1; }
        .map-tile { display: inline-block; width: 20px; height: 20px; text-align: center; line-height: 20px; font-family: monospace; }
        .player-tile { background-color: #90ee90; }
        .npc-tile { background-color: #add8e6; }
        .player-npc-tile { background-color: #9370db; }

        /* Character Interaction */
        #character-interaction { display: flex; flex-direction: column; height: 100%; flex-grow: 1; }
        #npc-list { flex-grow: 1; overflow-y: auto; }
        .character-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        #character-portrait { width: 100%; max-width: 300px; display: block; margin: 10px auto; flex-shrink: 1; object-fit: contain; }
        #dialogue-input-container { display: flex; margin-top: auto; }
        #dialogue-input-character { flex-grow: 1; margin-right: 5px; }
        #back-to-npc-list { background-color: #6c757d; }
        #back-to-npc-list:hover { background-color: #5a6268; }

        /* --- Dark Mode --- */
        body.dark-mode { background-color: #121212; color: #e0e0e0; }
        body.dark-mode .container { background-color: #1e1e1e; }
        body.dark-mode h1, body.dark-mode h2, body.dark-mode h3 { color: #e0e0e0; }
        body.dark-mode #dialogue-box, body.dark-mode .map-container { background-color: #2a2a2a; border-color: #444; }
        body.dark-mode #game-map { background-color: #2a2a2a; }
        body.dark-mode .game-state-card { background-color: #2a2a2a; border-color: #444; }
        body.dark-mode .tabs { background-color: #1e1e1e; border-color: #444; }
        body.dark-mode .tablink { background-color: #333; color: #bbb; }
        body.dark-mode .tablink:hover { background-color: #444; }
        body.dark-mode .tablink.active { background-color: #2a2a2a; color: #4dabf7; border-bottom-color: #4dabf7; }
        body.dark-mode input[type="text"] { background-color: #333; color: #e0e0e0; border-color: #555; }
        body.dark-mode button { background-color: #4dabf7; color: #121212; }
        body.dark-mode button:hover { background-color: #82c9ff; }
        body.dark-mode #back-to-npc-list { background-color: #555; }
        body.dark-mode #back-to-npc-list:hover { background-color: #666; }
        body.dark-mode .d-pad-container { background-color: #2a2a2a; }
        body.dark-mode .d-pad-button { background-color: #444; }
        body.dark-mode .d-pad-button:hover { background-color: #555; }
        body.dark-mode .modal-content { background-color: #2a2a2a; border-color: #444; color: #e0e0e0; }
        body.dark-mode .close-button { color: #888; }
        body.dark-mode .close-button:hover { color: #ccc; }
        body.dark-mode #dark-mode-toggle { color: #e0e0e0; }

    </style>
</head>
<body>
    <div class="container">
        <div class="header-bar">
            <h1>ChatRPG - <span id="world-name"></span></h1>
            <div class="header-right-items">
                <button id="dark-mode-toggle">‚òÄÔ∏è</button>
                <div id="status" title="Checking server connection..."></div>
                <span class="hamburger-menu" onclick="openModal('dataGenerationModal')">‚ò∞</span>
            </div>
        </div>

        <div class="main-game-area">
            <div class="top-row">
                <div class="map-container">
                    <div class="tabs">
                        <button class="tablink active" onclick="openTab(event, 'map-tab')">Map</button>
                        <button class="tablink" onclick="openTab(event, 'character-tab')">Character</button>
                    </div>

                    <div id="map-tab" class="tabcontent" style="display:flex">
                        <pre id="game-map"></pre>
                    </div>

                    <div id="character-tab" class="tabcontent" style="display:none">
                        <div id="npc-list"></div>
                        <div id="character-interaction" style="display:none;">
                            <div class="character-header">
                                <h3 id="character-name"></h3>
                                <button id="back-to-npc-list">Back</button>
                            </div>
                            <img id="character-portrait" src="" alt="Character Portrait">
                            <div id="dialogue-input-container">
                                <input type="text" id="dialogue-input-character" placeholder="Type your message...">
                                <button id="dialogue-send-button-character">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="dialogue-box">
                    <div class="messages">
                        <div class="npc-message message">Game: Welcome to Gemini NPC Game! Initializing...</div>
                    </div>
                </div>
            </div>

            <div class="bottom-row">
                <div class="commands-area">
                    <h2>Navigation</h2>
                    <div class="d-pad-container">
                        <button id="go-north-button" class="d-pad-button north">N</button>
                        <button id="go-west-button" class="d-pad-button west">W</button>
                        <button id="look-button" class="d-pad-button center">Look</button>
                        <button id="go-east-button" class="d-pad-button east">E</button>
                        <button id="go-south-button" class="d-pad-button south">S</button>
                    </div>
                </div>
                <div class="commands-area">
                    <h2>Other Commands</h2>
                    <div id="other-commands">
                        <button id="inventory-button">Inventory</button>
                        <button id="enter-exit-button">Enter/Exit</button>
                    </div>
                </div>
                <div id="game-state" class="game-state-card">
                    <p><strong>Player:</strong> <span id="player-name"></span></p>
                    <p><strong>Location:</strong> <span id="current-location"></span></p>
                    <p><strong>Health:</strong> <span id="player-health"></span></p>
                    <p><strong>Gold:</strong> <span id="player-gold"></span></p>
                    <p><strong>Inventory:</strong> <span id="player-inventory"></span></p>
                    <p><strong>Quests:</strong> <span id="quest-log"></span></p>
                </div>
            </div>
        </div>

    </div>

    <!-- The Modal -->
    <div id="dataGenerationModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('dataGenerationModal')">&times;</span>
            <h2>Generate New Game Data</h2>
            <p>Enter a request for Gemini to generate new character or location data, or select from existing content.</p>
            <input type="text" id="data-generation-input" placeholder="e.g., 'a grumpy dwarf' or 'a dark cave'">
            <button id="generate-data-button">Generate Data</button>

            <h3>Saved Worlds</h3>
            <div id="world-list"></div>
        </div>
    </div>

    <script>
        // --- Element References ---
        const dialogueBoxMessages = document.getElementById('dialogue-box').querySelector('.messages');
        const statusBox = document.getElementById('status');
        const dataGenerationInput = document.getElementById('data-generation-input');
        const generateDataButton = document.getElementById('generate-data-button');
        const worldListDiv = document.getElementById('world-list');
        const characterTab = document.getElementById('character-tab');
        const npcListDiv = document.getElementById('npc-list');
        const characterInteractionDiv = document.getElementById('character-interaction');
        const characterPortrait = document.getElementById('character-portrait');
        const characterName = document.getElementById('character-name');
        const dialogueInputCharacter = document.getElementById('dialogue-input-character');
        const dialogueSendButtonCharacter = document.getElementById('dialogue-send-button-character');
        const backToNpcListButton = document.getElementById('back-to-npc-list');
        const goNorthButton = document.getElementById('go-north-button');
        const goEastButton = document.getElementById('go-east-button');
        const goSouthButton = document.getElementById('go-south-button');
        const goWestButton = document.getElementById('go-west-button');
        const inventoryButton = document.getElementById('inventory-button');
        const lookButton = document.getElementById('look-button');
        const enterExitButton = document.getElementById('enter-exit-button');
        const darkModeToggleButton = document.getElementById('dark-mode-toggle');

        // --- Game State ---
        let sessionId = localStorage.getItem('gameSessionId');
        let currentNPCId = null;
        const maxMessages = 50;

        // --- Dark Mode --- 
        function setDarkMode(isDark) {
            if (isDark) {
                document.body.classList.add('dark-mode');
                darkModeToggleButton.textContent = 'üåô'; // Moon
                localStorage.setItem('darkMode', 'enabled');
            } else {
                document.body.classList.remove('dark-mode');
                darkModeToggleButton.textContent = '‚òÄÔ∏è'; // Sun
                localStorage.setItem('darkMode', 'disabled');
            }
        }

        darkModeToggleButton.addEventListener('click', () => {
            const isDarkMode = document.body.classList.contains('dark-mode');
            setDarkMode(!isDarkMode);
        });

        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            setDarkMode(true);
        }

        // --- Modal Functions ---
        window.openModal = function(modalId) {
            document.getElementById(modalId).style.display = 'block';
            if (modalId === 'dataGenerationModal') {
                listWorlds();
            }
        }

        window.closeModal = function(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- UI Updates ---
        function trimDialogueBox() {
            const messages = dialogueBoxMessages.querySelectorAll('.message');
            if (messages.length > maxMessages) {
                for (let i = 0; i < messages.length - maxMessages; i++) {
                    messages[i].remove();
                }
            }
        }

        function toggleMovementControls(enable) {
            goNorthButton.disabled = !enable;
            goEastButton.disabled = !enable;
            goSouthButton.disabled = !enable;
            goWestButton.disabled = !enable;
            lookButton.disabled = !enable;
            enterExitButton.disabled = !enable;
            document.removeEventListener('keydown', handleArrowKeys);
            if (enable) {
                document.addEventListener('keydown', handleArrowKeys);
            }
        }

        function handleArrowKeys(event) {
            switch (event.key) {
                case 'ArrowUp': sendCommand('go north'); event.preventDefault(); break;
                case 'ArrowDown': sendCommand('go south'); event.preventDefault(); break;
                case 'ArrowLeft': sendCommand('go west'); event.preventDefault(); break;
                case 'ArrowRight': sendCommand('go east'); event.preventDefault(); break;
            }
        }

        function updateMapDisplay(mapData) {
            const gameMap = document.getElementById('game-map');
            gameMap.innerHTML = '';
            if (!mapData || !mapData.grid) {
                gameMap.textContent = 'No map data available.';
                return;
            }
            mapData.grid.forEach(row => {
                const rowDiv = document.createElement('div');
                row.forEach(tile => {
                    const tileSpan = document.createElement('span');
                    tileSpan.textContent = tile.char;
                    tileSpan.className = 'map-tile';
                    if (tile.has_player && tile.has_npc) tileSpan.classList.add('player-npc-tile');
                    else if (tile.has_player) tileSpan.classList.add('player-tile');
                    else if (tile.has_npc) tileSpan.classList.add('npc-tile');
                    rowDiv.appendChild(tileSpan);
                });
                gameMap.appendChild(rowDiv);
            });
        }

        window.openTab = function(evt, tabName) {
            let i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablink");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "flex";
            evt.currentTarget.className += " active";
            toggleMovementControls(tabName === 'map-tab');
        }

        function updateGameStateUI(data) {
            document.getElementById('player-name').textContent = data.player_name;
            document.getElementById('current-location').textContent = data.current_location;
            document.getElementById('world-name').textContent = data.world_name;
            document.getElementById('player-health').textContent = data.health;
            document.getElementById('player-gold').textContent = data.gold;
            document.getElementById('player-inventory').textContent = data.inventory.join(', ') || 'Empty';
            document.getElementById('quest-log').textContent = data.quest_log.join(', ') || 'None';
            updateMapDisplay(data.map_display);
        }

        function addMessageToDialogue(htmlContent) {
            dialogueBoxMessages.innerHTML += htmlContent;
            trimDialogueBox();
            dialogueBoxMessages.scrollTop = dialogueBoxMessages.scrollHeight;
        }

        // --- API Communication ---
        async function fetchFromServer(endpoint, body) {
            const url = `http://127.0.0.1:8000${endpoint}`;
            const options = {
                method: body ? 'POST' : 'GET',
                headers: { 'Content-Type': 'application/json' },
                body: body ? JSON.stringify(body) : undefined,
            };
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status}, details: ${errorText}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`Error fetching from ${endpoint}:`, error);
                addMessageToDialogue(`<div class="npc-message message" style="color: red;">Error: Could not connect to the server.</div>`);
                return null;
            }
        }

        async function checkServerStatus() {
            try {
                const response = await fetch('http://127.0.0.1:8000/health');
                statusBox.className = (response.ok && (await response.json()).status === 'ok') ? 'status-ok' : 'status-error';
                statusBox.title = (response.ok) ? 'Server Connection: OK' : 'Server Connection: FAILED';
            } catch (error) {
                statusBox.className = 'status-error';
                statusBox.title = 'Server Connection: FAILED';
            }
        }

        async function sendDialogue(message) {
            if (!message || !currentNPCId) return;
            addMessageToDialogue(`<div class="user-message message">You: ${message}</div>`);
            addMessageToDialogue(`<div class="loading message">${characterName.textContent} is thinking...</div>`);
            
            const data = await fetchFromServer('/interact', { session_id: sessionId, message: message });

            document.querySelector('.loading')?.remove();
            if (data) {
                sessionId = data.session_id;
                localStorage.setItem('gameSessionId', sessionId);
                updateGameStateUI(data);
                if (data.character_portrait) {
                    characterPortrait.src = data.character_portrait;
                    characterPortrait.style.display = 'block';
                } else {
                    characterPortrait.style.display = 'none';
                }
                const npcName = characterName.textContent || 'NPC';
                addMessageToDialogue(`<div class="npc-message message"><strong>${npcName}:</strong> ${data.dialogue}</div>`);
            }
            dialogueSendButtonCharacter.disabled = false;
        }

        async function sendCommand(command) {
            addMessageToDialogue(`<div class="user-message message">You: ${command}</div>`);
            toggleMovementControls(false);
            addMessageToDialogue(`<div class="loading message">Processing command...</div>`);

            const data = await fetchFromServer('/command', { session_id: sessionId, command: command });

            document.querySelector('.loading')?.remove();
            if (data) {
                sessionId = data.session_id;
                localStorage.setItem('gameSessionId', sessionId);
                updateGameStateUI(data);
                if (data.npcs_in_location && data.npcs_in_location.length > 0) {
                    npcListDiv.innerHTML = '<h3>NPCs Here:</h3>';
                    data.npcs_in_location.forEach(npc => {
                        const npcButton = document.createElement('button');
                        npcButton.textContent = npc.name;
                        npcButton.onclick = () => startCharacterInteraction(npc.id, npc.name);
                        npcListDiv.appendChild(npcButton);
                    });
                } else {
                    npcListDiv.innerHTML = '<p>No NPCs in this location.</p>';
                }
                addMessageToDialogue(`<div class="npc-message message">Game: ${data.dialogue}</div>`);
            }
            dialogueSendButtonCharacter.disabled = false;
            if (document.getElementById('map-tab').style.display === 'flex') {
                toggleMovementControls(true);
            }
        }
        
        // --- Event Listeners ---
        goNorthButton.addEventListener('click', () => sendCommand('go north'));
        goEastButton.addEventListener('click', () => sendCommand('go east'));
        goSouthButton.addEventListener('click', () => sendCommand('go south'));
        goWestButton.addEventListener('click', () => sendCommand('go west'));
        inventoryButton.addEventListener('click', () => sendCommand('inventory'));
        lookButton.addEventListener('click', () => sendCommand('look'));
        enterExitButton.addEventListener('click', () => sendCommand('enter'));

        async function startCharacterInteraction(npcId, npcName) {
            currentNPCId = npcId;
            characterName.textContent = npcName;
            npcListDiv.style.display = 'none';
            characterInteractionDiv.style.display = 'flex';
            try {
                const portraitResponse = await fetch(`http://127.0.0.1:8000/npc_portrait/${npcId}`);
                if (portraitResponse.ok) {
                    const portraitData = await portraitResponse.json();
                    characterPortrait.src = portraitData.portrait_url;
                    characterPortrait.style.display = 'block';
                } else {
                    characterPortrait.style.display = 'none';
                }
            } catch (error) {
                characterPortrait.style.display = 'none';
            }
            await sendCommand(`talk to ${npcName}`);
        }

        backToNpcListButton.addEventListener('click', () => {
            currentNPCId = null;
            npcListDiv.style.display = 'block';
            characterInteractionDiv.style.display = 'none';
            characterPortrait.style.display = 'none';
            if (document.getElementById('map-tab').style.display === 'flex') {
                toggleMovementControls(true);
            }
        });

        dialogueSendButtonCharacter.addEventListener('click', () => {
            if (currentNPCId) {
                sendDialogue(dialogueInputCharacter.value.trim());
                dialogueInputCharacter.value = '';
            }
        });

        dialogueInputCharacter.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && currentNPCId) {
                sendDialogue(dialogueInputCharacter.value.trim());
                dialogueInputCharacter.value = '';
            }
        });

        async function initializeGame() {
            console.log("initializeGame called.");
            addMessageToDialogue(`<div class="npc-message message">Game: Welcome to ChatRPG! Initializing...</div>`);
            const data = await fetchFromServer('/start', { session_id: sessionId });
            console.log("Data from /start endpoint:", data);
            if (data) {
                sessionId = data.session_id;
                localStorage.setItem('gameSessionId', sessionId);
                updateGameStateUI(data);
                console.log("World name from data:", data.world_name);
                addMessageToDialogue(`<div class="npc-message message">Game: ${data.dialogue}</div>`);
                if (data.npcs_in_location && data.npcs_in_location.length > 0) {
                    npcListDiv.innerHTML = '<h3>NPCs Here:</h3>';
                    data.npcs_in_location.forEach(npc => {
                        const npcButton = document.createElement('button');
                        npcButton.textContent = npc.name;
                        npcButton.onclick = () => startCharacterInteraction(npc.id, npc.name);
                        npcListDiv.appendChild(npcButton);
                    });
                } else {
                    npcListDiv.innerHTML = '<p>No NPCs in this location.</p>';
                }
                toggleMovementControls(true);
            }
        }

        async function listWorlds() {
            const data = await fetchFromServer('/list_worlds');
            if (data) {
                worldListDiv.innerHTML = '';
                data.worlds.forEach(worldName => {
                    const button = document.createElement('button');
                    button.textContent = worldName.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    button.onclick = () => loadWorld(worldName);
                    worldListDiv.appendChild(button);
                });
            }
        }

        async function loadWorld(worldName) {
            addMessageToDialogue(`<div class="user-message message">Loading world: ${worldName}...</div>`);
            const data = await fetchFromServer('/load_world', { world_name: worldName });
            if (data) {
                addMessageToDialogue(`<div class="npc-message message">Game: ${data.message}</div>`);
                initializeGame(); // Re-initialize game to load new data
                closeModal('dataGenerationModal'); // Close modal after loading world
            }
        }

        async function generateData(request = null) {
            const requestText = request || dataGenerationInput.value.trim();
            if (!requestText) return;

            addMessageToDialogue(`<div class="user-message message">Generating data for: ${requestText}...</div>`);

            const data = await fetchFromServer('/generate_data', { request: requestText });
            if (data) {
                addMessageToDialogue(`<div class="npc-message message">Game: ${data.message}</div>`);
                initializeGame(); // Re-initialize game to load new data
                listWorlds(); // Refresh world list after generating new data
            }
            dataGenerationInput.value = '';
        }

        generateDataButton.addEventListener('click', () => generateData());
        dataGenerationInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generateData();
            }
        });

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            checkServerStatus();
            initializeGame();
            listWorlds();
        });

    </script>
</body>
</html>